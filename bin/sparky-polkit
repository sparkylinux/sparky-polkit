#! /bin/bash

# The script starts lxpolkit or gnome-policykit in window managers
# installed via APTus Desktop, Minimal ISO and so.
# Copyright Pawe≈Ç Pijanowski 2017-2018 under GNU GPL 3
# Last update 2018/03/19

BUDGIEPOLKIT="`pidof budgie-polkit-dialog`"
GNOMEPOLKIT="`pidof polkit-gnome-authentication-agent-1`"
KDEPOLKIT="`pidof polkit-kde-authentication-agent-1`"
LXDEPOLKIT="`pidof lxpolkit`"
LXQTPOLKIT="`pidof lxqt-policykit-agent`"
MATEPOLKIT="`pidof polkit-mate-authentication-agent-1`"
PANTHEONPOLKIT="`pidof pantheon-agent-polkit`"

CHECKLUMINA="`pidof lumina desktop`"
CHECKLXDE="`pidof lxsession`"
CHECKGNOMEFLASH="`pidof gnome-flashback`"
CHECKGNOMESHELL="`pidof gnome-shell`"

if [ -f /usr/lib/policykit-1-gnome/polkit-gnome-authentication-agent-1 ]; then
	CHECKGNOMEPOLKIT="/usr/lib/policykit-1-gnome/polkit-gnome-authentication-agent-1"
fi
CHECKLXDEPOLKIT="`which lxpolkit`"

if [ "$CHECKGNOMEPOLKIT" = "" ] && [ "$CHECKLXDEPOLKIT" = "" ]; then
	echo "Error: You have to install lxpolkit or policykit-1-gnome package"
	exit 1
elif [ "$CHECKLXDEPOLKIT" != "" ]; then
	SPARKYPOLKIT="$CHECKLXDEPOLKIT"
elif [ "$CHECKGNOMEPOLKIT" != "" ]; then
	SPARKYPOLKIT="$CHECKGNOMEPOLKIT"
fi

# budgie
if [ "$BUDGIEPOLKIT" != "" ]; then
	exit 1
#gnome
elif [ "$CHECKGNOMEFLASH" != "" ] || [ "$CHECKGNOMESHELL" != "" ]; then
	exit 1
# kde
elif [ "$KDEPOLKIT" != "" ]; then
	exit 1
# lumina
elif [ "$CHECKLUMINA" != "" ]; then
	if [ "$GNOMEPOLKIT" != "" ]; then
		killall -9 polkit-gnome-authentication-agent-1
	fi
	if [ "$LXDEPOLKIT" != "" ]; then
		exit 1
	else
		$CHECKLXDEPOLKIT &
	fi
# lxde
elif [ "$CHECKLXDE" != "" ]; then
	if [ "$GNOMEPOLKIT" != "" ]; then
		killall -9 polkit-gnome-authentication-agent-1
	fi
	if [ "$LXDEPOLKIT" != "" ]; then
		exit 1
	else
		$CHECKLXDEPOLKIT &
	fi
# lxqt
elif [ "$LXQTPOLKIT" != "" ]; then
	exit 1
# mate
elif [ "$MATEPOLKIT" != "" ]; then
	exit 1
# pantheon
elif [ "$PANTHEONPOLKIT" != "" ]; then
	exit 1
# others
else
	if [ "$GNOMEPOLKIT" = "" ] && [ "$LXDEPOLKIT" = "" ]; then
		$SPARKYPOLKIT &
		exit 0
	fi
fi

exit 0
